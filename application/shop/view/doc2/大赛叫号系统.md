
## 大赛叫号系统


流程：  
1、在赛区是状态1报名或者2比赛的时候，可以签到。  
2、每次签到，服务端先校验。如果校验通过，保存uid到第一轮的等待列表。  
3、当比赛开始后，此时依然可以签到。  
4、需要点击“开始比赛”按钮，才可以开始比赛，即开始叫号流程。  
5、比赛开始接口和轮次增加接口其实是同一个。  
6、比赛开始后，管理员喇叭喊叫号列表里的人，如果人上台，则管理员点击“叫号”这个用户。  
7、如果管理员发现找不到人，管理员应该点击“过号”这个用户，或喇叭喊其他人。    
8、如果叫号后，发现人搞错了，管理员应该点击“过号”电脑里的“当前表演者”  
9、评委用小程序打分，而客户端调用通用接口可以知道当前表演者是谁。  
10、比赛结束的判断条件，等待列表为空了，就可以结束了。否则不能结束。  
11、如果想进行第2轮也可以，点击“开始下一轮”按钮。  
12、从第2轮开始，等待列表中的人是由上一轮的成功晋级人组成的。  
13、点击“结束比赛”后，会把redis中的成功晋级者保存到数据库。    


注意：  
1、过号时，可以选等待列表里的人，或当前表演者。  并转移到过号列表（转移到的意思是原先的地方会清除此用户，下同）。  
2、叫号时，可以选等待列表，过号列表里的人。并转移到当前表演者。  
3、用户通用信息包括：叫号序号，bobo号，真实姓名，头像。  
4、叫号是前端控制的，可以不按顺序，也可以不点击“过号”按钮，则那个人会一直在等待列表中。    
5、现在只有后台签到的接口  
6、**客户端调用叫号，过号，开始比赛这三个接口时，请一定在收到返回以后，再调用公共查询接口刷新页面。**

## 参赛用户通用格式
| 名称        | 类型 |含义  |
| -------- |:------|:------|
| uid     | string  |  用户id |
| realname| string  |  用户真实姓名 |
| pic     | string  |  用户头像 |
|sort     | int  |  叫号的序号，注意只有客户端调用轮次增加接口后，此字段才有效。  |
|score     | int  |  注意：只有当前表演者有此字段！0未打分，1晋级，2失败 |






## 签到列表

功能：显示所有签到列表。服务端不分页。  
功能：注意，本接口的sort字段是无用的。不要关心sort。

~~~
/backstage/round/signin_index
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|


返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| list     | array  |  参赛用户列表，字段见《参赛用户通用格式》 |




## 后台签到

功能：管理员在后台给用户签到。  
条件：赛区报名阶段，和比赛阶段才可以签到。对应ds_race_field（赛区表）的status 为1或者2  
条件：赛区有效。  
条件：赛区的轮次字段不能大于1  
条件：用户已经在该赛区报名。  
条件：用户已经缴纳费用，已经填写好档案。假如大赛有的话。  
条件：用户还没有签到。  

~~~
/backstage/round/signin
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|
|uid         |  用户id |

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| 无     |   |   |



## 开始比赛 / 轮次增加 / 开始下一轮

功能：比赛开始前，必须调用此接口。当一轮比赛结束后，如果想继续下一轮，则也调用此接口。    
功能：服务端会对签到人员进行排序。  
条件：当开始第2轮或更高时，服务端会检查等待列表中是否有人，如果有，服务端会拒绝客户端。    

~~~
/backstage/round/add_round
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| round     | int  | 增加后的当前轮次  |




## 叫号

功能：可以选等待列表，过号列表里的人。并转移到当前表演者。如果没有，返回400  

~~~
/backstage/round/calling
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|
|uid         |  用户id |

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| 无     |   |  |



## 过号

功能：可以选等待列表里的人，或当前表演者。 并转移到过号列表。如果没有，返回400  
功能：如果选了当前表演者，则当前表演者为空，请客户端一定注意，这时打分必定错误。

~~~
/backstage/round/ignore
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|
|uid         |  用户id |

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| 无     |   |  |


## 打分

功能：小程序里，评委给当前表演者（只有1个表演者）打分  

~~~
/backstage/round/comment
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|
|status         |  1表示通过，2表示否决 |

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| 无     |   | |



## 结束比赛

功能：结束比赛，  把最后一轮晋级者记录到数据库。  
条件：等待列表为空。

~~~
/backstage/round/finish
~~~
~~~
POST
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| success_count     | int  | 最后的成功晋级人数 |



## 公共查询接口-全部

功能：显示所有列表项和当前表演者  

~~~
/backstage/round/get_public_query_common
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|


返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| common     | object  |  全部列表|

| common通用格式        | 类型 |含义  |
| -------- |:------|:------|
| waiting_list     | array  | 本轮等待列表，每个元素参见《参赛用户通用格式》 |
| ignore_list     | array  | 本轮过号列表，每个元素参见《参赛用户通用格式》 |
| success_list     | array  | 本轮晋级列表，每个元素参见《参赛用户通用格式》 |
| current     | object  | 本轮当前表演者，格式等同于《参赛用户通用格式》 |
| round     | int  | 当前第几轮 |




## 公共查询接口-当前表演者

~~~
/backstage/round/get_public_query_current
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|


返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| current     | object  |  参赛用户列表，字段见《公共查询接口-全部》-> comment -> current  |



## 公共查询接口-等待列表

~~~
/backstage/round/get_public_query_waiting_list
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|


返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| waiting_list     | array  |  参赛用户列表，字段见《公共查询接口-全部》-> comment -> waiting_list  |


## 公共查询接口-晋级列表

~~~
/backstage/round/get_public_query_success_list
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|


返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| success_list     | array  |  参赛用户列表，字段见《公共查询接口-全部》-> comment -> success_list  |



## 公共查询接口-过号列表  

~~~
/backstage/round/get_public_query_ignore_list
~~~
~~~
GET
~~~

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|field_id         |  赛区id|

返回：   
| 返回        | 类型 |含义  |
| -------- |:------|:------|
| ignore_list     | array  |  参赛用户列表，字段见《公共查询接口-全部》-> comment -> ignore_list  |







