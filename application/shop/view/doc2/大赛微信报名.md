
## 获取微信openid

~~~
/race/weblogin/get_open_id
~~~
~~~
GET
~~~

功能：  

1. 仅限web调用，根据客户端的code，我返回该用户的openid，目的是用于支付。

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|code         |  用于验证个人身份用，这个code是客户端自行调用微信得到。 |

返回：   
| 返回字段        | 类型|含义  |
| -------- |:------||:------|
|openid         |  该用户的openid |


<br><br><br><br><br>




## 大赛微信报名

~~~
/race/weblogin/index
~~~
~~~
GET
~~~

功能：  

1. 第一个接口，校验微信登录的真实性，成功重定向到填写手机页面，失败重定向到前一个页面。
1. 服务器把当前用户的微信信息记录到自己的会话。

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|code         |  微信服务器的返回，用于验证个人身份用 |
|return       |  base64编码，类似{'success_url'=>'','fail_url' =>'','id'=>11, 'type'=>'dasai' }|

返回：   重定向到请求参数的success_url，或者是  fail_url

<br><br><br><br><br>


~~~
/race/weblogin/login
~~~
~~~
POST
~~~

功能：  

1. 第2个接口，校验手机号的真实性，自动绑定手机号和微信号，并记录到会话
1. 此接口调用成功后，客户端应该跳转到填写个人信息的页面。


| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|phone         |  手机号 |
|check_code       |  手机号验证码 |

| 返回        | 类型  |含义|
| -------- |:------||:------|
|uid       |int  |  uid,结果正确此字段才有， |
|token     | string    | token,结果正确此字段才有， |
|id              | string    | 第一次请求客户端参数 |
|type            | string    | 第一次请求客户端参数 |
|success_url     | string    | 第一次请求客户端参数 |
|fail_url        | string    | 第一次请求客户端参数 |
|pk        | bool    | 第一次请求客户端参数 |


<br><br><br><br><br>




## 大赛报名（201808，v=5）
~~~
/race/weblogin/register_new
~~~
~~~
POST
~~~
~~~
v=5
~~~


~~~
大赛报名流程（20180824）
首先填写基本信息，基本信息填写完后且上传服务器之后，客户端根据upload_type跳转到上传页面，
大赛的基本信息中有一个upload_type
为1或3时，跳转到视频上传页面，为2或4时，跳转到图片上传页面。
如为3或者4，页面上有一个“跳过当前步骤”的按钮。

当用户点击“跳过当前步骤”或者 上传了视频和图片后。
根据返回的money_fen（报名费，单位分）是否大于0，判断是否应该跳转支付页面。

假如不需跳转，则报名流程走完，且报名成功。
假如需跳转，则支付，支付完之后，报名全部成功。

另外，假设，用户在提交了基本信息后的任何界面不停点击取消，也没有关系。因为服务器已经记录了当前的报名步骤。

当显示报名详情时，按钮根据
大赛报名状态 / race/index/ get_user_status_new 这个接口返回的status 显示按钮状态。

~~~


功能：  

1. 大赛报名，分两步，第一步，调本接口，传基本信息，附加信息。  
1. 第二步，也调本接口，传图片或视频。  
1. 对于第二步，参数是 v=5,is_upload=1,uid,ds_id,如果图片，则pic_list


| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|v         |  必填，5 |
|uid         |  账号id，20180606加 |
|phone         |  当前页面填写的手机号，必填 |
|name       |  当前页面填写的真实姓名 |
|sex       |  1男，0女，必填 |
|birthday       |  生日，格式必须类似2018-01，必填 |
|ds_id       |  大赛id，必填 |
|qudao_id       |  赛区id，线上大赛无此选项固定传0，线下大赛必须选择此项，不能为0 |
|pic       |  用户上传自己的头像， |
|pic_list  |  如果该大赛要求上传照片，值，类似 http://1.jpg,http://2.jpg，是英文逗号分隔的网址  |
|record_url|  如果该大赛要求上传视频，值，类似 http://1.mp4 |
|record_pic|  如果该大赛要求上传视频，这是视频的封面图，值，类似 http://1.jpg |
|addi_info |  附加信息，是json文本，类似{"身高":"174","体重":"12222"}，如果没有附加信息，请传{} |
|is_upload |  is_upload=1，表示pic_list和record_url 必须有一个有值，表示是上传提交。is_upload=0，表明是最开始的提交。  |




| 返回        | 类型  |含义|
| -------- |:------||:------|
|status       |int  |  参见[大赛报名状态新](/shop/doc/index2/name/大赛报名状态新) |
|money_fen       |int  |  单位分，报名费。如果该值大于0，则客户端应该跳转到支付页面 |


<br><br><br><br><br>







~~~
/race/weblogin/register_new（v=1废止）
~~~
~~~
POST
~~~

功能：  

1. 第3个接口，用户填写真实姓名等个人资料，
1. 此接口调用成功后，客户端应根据我返回的status字段，跳转至不同的页面。未支付，则去支付。用户完成报名未上传视频，则去上传视频。其余状态直接返回状态码对应的信息给用户。

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|uid         |  账号id，20180606加 |
|phone         |  当前页面填写的手机号，必填 |
|name       |  当前页面填写的真实姓名 |
|sex       |  1男，0女，必填 |
|birthday       |  生日，格式必须类似2018-01，必填 |
|ds_id       |  大赛id，必填 |
|area1_name  |  省，必填 |
|area2_name  |  市，必填 |
|height       |  身高，单位厘米，必填 |
|weight       |  体重，单位公斤，必填 |
|qudao_id       |  赛区id，线上大赛无此选项固定传0，线下大赛必须选择此项，不能为0 |
|pic       |  用户形象照，20180604加 |



| 返回        | 类型  |含义|
| -------- |:------||:------|
|status       |int  |  参见[大赛报名状态新](/shop/doc/index2/name/大赛报名状态新) |
|money       |float  |  单位元，报名费。 |
|has_pay       | int  | 0表示用户需要马上缴费，1表示不需要，于是用户应该去上传短视频。 |

<br><br><br><br><br>


~~~
/race/pay/create_html
~~~
~~~
POST
~~~
~~~
v=5
~~~

功能：  

1. 第4个接口，微信统一下单接口，
1. 微信支付之前，必须由服务器统一下单，然后发送下单数据给客户端，只有这样，客户端才能调起微信支付页面。

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|uid         |  uid，必填 |
|ds_id       |  大赛id |
|openid      |  openid，必填。 |
|v      |  5 |


| 返回        | 类型  |含义|
| -------- |:------||:------|
|appId       | string  |  微信返回 |
| nonceStr       | string  |  微信返回 |
|package       | string  |  微信返回 |
|signType       | string  |  微信返回 |
|timeStamp       | string  |  微信返回 |
|paySign       | string  |  微信返回 |

<br><br><br><br><br>


~~~
--/record/recordmanager/upload_record--
~~~
~~~
POST
~~~

功能：  

1. 第5个接口，上传短视频，
1. 写在这里是因为只写了大赛报名所需的参数

| 请求参数字段        | 请求参数含义  |
| -------- |:------|
|uid         |  uid，必填 |
|token       |  token |
|type      |  4表示大赛视频 |
|title      |  视频标题 |
|label      |  视频分类，整数 |
|activity_id     |  大赛id，必填 |
|video_path      |  短视频网址，必填。 |
|  thumbnailpath    |  封面图片 |
|  sort    |  11红方，12蓝方 |


| 返回        | 类型  |含义|
| -------- |:------||:------|
|无       |  |   |











